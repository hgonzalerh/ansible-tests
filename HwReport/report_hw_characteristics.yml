- name: Gather facts for all inventory
  hosts: all
  # redundant but explicit
  gather_facts: true
  tasks:
    - name: Show all facts we're insterested in, for debugging only
      ansible.builtin.debug:
        var: "{{ item }}"
        verbosity: 2
      loop:
        - ansible_distribution_version
        - ansible_distribution_file_variety
        - ansible_kernel
        - ansible_processor
        - ansible_system_vendor
        - ansible_swaptotal_mb
        - ansible_machine
        - ansible_memtotal_mb
        - ansible_dns.nameservers
        - ansible_processor_count
        - ansible_all_ipv4_addresses

- name: Render template
  hosts: localhost
  tasks:
    - name: Render file locally
      ansible.builtin.template:
        src: templates/report.csv.j2
        dest: report_hw.csv

- name: Copy report to the first server in the inventory
  hosts: all[0]
  tasks:
    - name: Copy report
      ansible.builtin.copy:
        src: report_hw.csv
        dest: ./
      tags:
        - transfer
